<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neuron News | –ù–æ–≤–æ—Å—Ç–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üß†</text></svg>">
    <style>
        /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        :root {
            --primary-color: #3a86ff;
            --secondary-color: #8338ec;
            --accent-color: #00d9ff;
            --danger-color: #ff006e;
            --warning-color: #ffbe0b;
            --success-color: #00ff88;
            --background-color: #0a0a1a;
            --surface-color: #12122e;
            --text-primary: #ffffff;
            --text-secondary: #b0b0c0;
            --border-radius: 16px;
            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 20px;
            --spacing-lg: 32px;
            --spacing-xl: 48px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--background-color) 0%, #1a1a2e 100%);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            padding-bottom: var(--spacing-xl);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-md);
        }

        /* Glassmorphism —ç—Ñ—Ñ–µ–∫—Ç */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        /* –•–µ–¥–µ—Ä */
        header {
            padding: var(--spacing-md) 0;
            margin-bottom: var(--spacing-lg);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 700;
            font-size: 1.5rem;
        }

        .logo-icon {
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-links {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
        }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(58, 134, 255, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-danger {
            background: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background: #ff0055;
        }

        .btn-warning {
            background: var(--warning-color);
            color: #000;
        }

        .btn-google {
            background: white;
            color: #444;
            border: 1px solid #ddd;
        }

        .btn-google:hover {
            background: #f5f5f5;
        }

        .btn-google i {
            color: #db4437;
        }

        /* –°—Ç—Ä–∞–Ω–∏—Ü—ã */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* –õ–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π */
        .feed-title {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: var(--spacing-lg);
        }

        .post-card {
            padding: var(--spacing-md);
            transition: var(--transition);
            cursor: pointer;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .post-card:hover {
            transform: translateY(-8px);
            border-color: rgba(0, 217, 255, 0.3);
        }

        .post-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: var(--spacing-md);
        }

        .post-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: var(--spacing-sm);
        }

        .tag {
            background: rgba(0, 217, 255, 0.1);
            color: var(--accent-color);
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            border: 1px solid rgba(0, 217, 255, 0.2);
        }

        .post-title {
            font-size: 1.25rem;
            margin-bottom: var(--spacing-sm);
            line-height: 1.4;
        }

        .post-title a {
            color: var(--text-primary);
            text-decoration: none;
        }

        .post-title a:hover {
            color: var(--accent-color);
        }

        .post-description {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-md);
            flex: 1;
        }

        .post-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: auto;
        }

        .read-more {
            color: var(--accent-color);
            text-decoration: none;
            font-weight: 500;
        }

        .read-more:hover {
            text-decoration: underline;
        }

        /* –°—Ç–∞—Ç—å—è */
        .article-container {
            padding: var(--spacing-xl);
            margin-top: var(--spacing-md);
        }

        .article-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            color: var(--text-secondary);
            font-size: 14px;
        }

        .article-title {
            font-size: 2.5rem;
            margin-bottom: var(--spacing-md);
            line-height: 1.3;
        }

        .article-content {
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: var(--spacing-xl);
        }

        .article-content img {
            max-width: 100%;
            border-radius: var(--border-radius);
            margin: var(--spacing-lg) 0;
        }

        /* –§–æ—Ä–º—ã */
        .form-container {
            padding: var(--spacing-xl);
            margin-top: var(--spacing-md);
        }

        .form-title {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            font-size: 2rem;
            color: var(--text-primary);
        }

        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-xs);
            color: var(--text-primary);
            font-weight: 500;
        }

        .form-input, .form-textarea, .form-select {
            width: 100%;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            transition: var(--transition);
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-file {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
        }

        .select-hint {
            display: block;
            margin-top: 4px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .form-actions {
            display: flex;
            gap: var(--spacing-md);
            justify-content: flex-end;
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-md);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* –¢–µ–≥–∏ */
        .tags-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .tag-option {
            padding: 6px 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
        }

        .tag-option:hover {
            background: rgba(0, 217, 255, 0.1);
        }

        .tag-option.selected {
            background: rgba(0, 217, 255, 0.2);
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
        .image-preview-container {
            margin-top: var(--spacing-md);
            padding: var(--spacing-md);
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .image-preview-title, .current-images-title {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: var(--spacing-sm);
        }

        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: var(--spacing-sm);
            margin-top: var(--spacing-sm);
        }

        .image-preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
        }

        .image-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview-remove {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            background: rgba(255, 0, 110, 0.8);
            border: none;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .upload-progress {
            margin-top: var(--spacing-md);
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
        }

        .upload-progress-bar {
            height: 6px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            width: 0%;
            transition: width 0.3s ease;
        }

        .upload-status {
            margin-top: var(--spacing-sm);
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
        }

        /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞–º–∏ */
        .posts-management {
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-xl);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .management-title {
            margin-bottom: var(--spacing-lg);
            font-size: 1.5rem;
        }

        .posts-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .post-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--spacing-md);
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .post-info {
            flex: 1;
        }

        .post-title {
            font-size: 1rem;
            margin-bottom: 4px;
        }

        .post-date {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .post-tags {
            display: flex;
            gap: 4px;
            margin-top: 6px;
        }

        .post-tag {
            font-size: 10px;
            padding: 2px 6px;
            background: rgba(0, 217, 255, 0.1);
            color: var(--accent-color);
            border-radius: 10px;
        }

        .post-images-count {
            font-size: 11px;
            padding: 2px 6px;
            background: rgba(255, 190, 11, 0.1);
            color: var(--warning-color);
            border-radius: 10px;
            margin-left: 6px;
        }

        .post-actions {
            display: flex;
            gap: 6px;
        }

        /* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ */
        .comments-section {
            margin-top: var(--spacing-xl);
            padding-top: var(--spacing-xl);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .comments-title {
            margin-bottom: var(--spacing-lg);
            font-size: 1.5rem;
        }

        .comment-form {
            margin-bottom: var(--spacing-xl);
        }

        .comment-input {
            width: 100%;
            padding: var(--spacing-md);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            resize: vertical;
            margin-bottom: var(--spacing-md);
        }

        .comment-form-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .comment-count {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }

        .comment-item {
            padding: var(--spacing-md);
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .comment-author {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        .comment-author-info {
            display: flex;
            flex-direction: column;
        }

        .comment-author-name {
            font-weight: 500;
            font-size: 14px;
        }

        .comment-author-email {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .comment-date {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .comment-content {
            line-height: 1.6;
            margin-bottom: var(--spacing-sm);
        }

        .comment-actions {
            display: flex;
            justify-content: flex-end;
        }

        .comment-action-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
            border-radius: 4px;
            transition: var(--transition);
        }

        .comment-action-btn.delete:hover {
            color: var(--danger-color);
            background: rgba(255, 0, 110, 0.1);
        }

        .empty-comments {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--text-secondary);
        }

        .empty-comments i {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            opacity: 0.5;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: var(--spacing-md);
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            width: 100%;
            max-width: 500px;
            animation: modalAppear 0.3s ease-out;
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-md);
            padding-bottom: var(--spacing-md);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-title {
            font-size: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .modal-body {
            padding: var(--spacing-md) 0;
        }

        .modal-text {
            margin-bottom: var(--spacing-lg);
            color: var(--text-secondary);
        }

        .modal-actions {
            display: flex;
            gap: var(--spacing-sm);
            justify-content: flex-end;
        }

        /* –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è */
        .auth-tabs {
            display: flex;
            gap: 1px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 4px;
            margin-bottom: var(--spacing-lg);
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            border-radius: 6px;
            transition: var(--transition);
        }

        .auth-tab.active {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .auth-divider {
            display: flex;
            align-items: center;
            margin: var(--spacing-lg) 0;
            color: var(--text-secondary);
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
        }

        .auth-divider span {
            padding: 0 var(--spacing-md);
            font-size: 14px;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        #notificationContainer {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .notification {
            padding: 16px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.3s ease-out;
            border-left: 4px solid var(--success-color);
        }

        .notification.error {
            border-left-color: var(--danger-color);
        }

        .notification.warning {
            border-left-color: var(--warning-color);
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* –£—Ç–∏–ª–∏—Ç—ã */
        .hidden {
            display: none !important;
        }

        .loader {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--text-secondary);
        }

        .loader i {
            margin-right: 8px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
            opacity: 0.5;
        }

        /* –ò–Ω–¥–µ–∫—Å–Ω–∞—è –æ—à–∏–±–∫–∞ */
        .index-error {
            padding: var(--spacing-md);
            background: rgba(255, 0, 110, 0.1);
            border: 1px solid rgba(255, 0, 110, 0.2);
            border-radius: 8px;
            color: var(--text-primary);
        }

        .index-error h4 {
            color: var(--danger-color);
            margin-bottom: 8px;
        }

        .index-error a {
            color: var(--accent-color);
            text-decoration: underline;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            .news-grid {
                grid-template-columns: 1fr;
            }
            
            .article-container,
            .form-container {
                padding: var(--spacing-md);
            }
            
            .article-title {
                font-size: 1.8rem;
            }
            
            .feed-title {
                font-size: 2rem;
            }
            
            .form-title {
                font-size: 1.5rem;
            }
            
            .modal {
                margin: var(--spacing-md);
            }
        }
    </style>
</head>
<body>
    <div id="notificationContainer"></div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div id="deleteModal" class="modal-overlay">
        <div class="modal glass">
            <div class="modal-header">
                <h3 class="modal-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
                <button class="modal-close" id="deleteModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <p class="modal-text">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –Ω–æ–≤–æ—Å—Ç—å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="deleteModalCancel">–û—Ç–º–µ–Ω–∞</button>
                    <button class="btn btn-danger" id="deleteModalConfirm">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ -->
    <div id="authModal" class="modal-overlay">
        <div class="modal glass">
            <div class="modal-header">
                <h3 class="modal-title">–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
                <button class="modal-close" id="authModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div class="auth-tabs">
                    <button class="auth-tab active" data-tab="login">–í—Ö–æ–¥</button>
                    <button class="auth-tab" data-tab="register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                </div>
                
                <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
                <form id="loginForm" class="auth-form active">
                    <div class="form-group">
                        <label for="loginEmail" class="form-label">Email</label>
                        <input type="email" id="loginEmail" class="form-input" placeholder="email@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="loginPassword" class="form-input" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                        <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
                    </button>
                </form>
                
                <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
                <form id="registerForm" class="auth-form">
                    <div class="form-group">
                        <label for="registerEmail" class="form-label">Email</label>
                        <input type="email" id="registerEmail" class="form-input" placeholder="email@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="registerPassword" class="form-input" placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤" minlength="6" required>
                    </div>
                    <div class="form-group">
                        <label for="registerConfirmPassword" class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                        <input type="password" id="registerConfirmPassword" class="form-input" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 10px;">
                        <i class="fas fa-user-plus"></i> –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                    </button>
                </form>
                
                <div class="auth-divider">
                    <span>–∏–ª–∏</span>
                </div>
                
                <button id="googleLoginBtn" class="btn btn-google" style="width: 100%;">
                    <i class="fab fa-google"></i>
                    –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
                </button>
            </div>
        </div>
    </div>

    <header class="container">
        <div class="header-content">
            <a href="#/" class="logo">
                <div class="logo-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="logo-text">Neuron News</div>
            </a>
            <div class="nav-links">
                <button id="adminBtn" class="btn btn-secondary hidden">
                    <i class="fas fa-cogs"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                </button>
                <button id="authBtn" class="btn btn-secondary">
                    <i class="fas fa-sign-in-alt"></i> –í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
                </button>
                <div id="userInfo" class="hidden" style="display: flex; align-items: center; gap: var(--spacing-sm);">
                    <div style="font-size: 14px; color: var(--text-secondary);">
                        <span id="userEmail"></span>
                    </div>
                    <button id="logoutBtn" class="btn btn-secondary">
                        <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–µ–Ω—Ç—ã -->
        <div id="homePage" class="page active">
            <h1 class="feed-title">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏</h1>
            <div id="newsFeed" class="news-grid">
                <div class="loader">
                    <i class="fas fa-spinner"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π...
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∞—Ç—å–∏ -->
        <div id="articlePage" class="page">
            <div id="articleContent" class="glass article-container">
                <div class="loader">
                    <i class="fas fa-spinner"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—å–∏...
                </div>
            </div>
        </div>

        <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
        <div id="adminPage" class="page">
            <div class="glass form-container">
                <h2 class="form-title" id="formTitle">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø—É–±–ª–∏–∫–∞—Ü–∏—é</h2>
                
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ ImgBB -->
                <div class="glass" style="padding: var(--spacing-md); margin-bottom: var(--spacing-lg); background: rgba(0, 200, 255, 0.05); border-color: rgba(0, 200, 255, 0.2);">
                    <h4 style="color: var(--accent-color); margin-bottom: 8px;">
                        <i class="fas fa-info-circle"></i> –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                    </h4>
                    <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 8px;">
                        –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –Ω–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Å–µ—Ä–≤–∏—Å ImgBB. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 32MB –Ω–∞ —Ñ–∞–π–ª.
                    </p>
                    <p style="font-size: 12px; color: var(--text-secondary);">
                        API –∫–ª—é—á ImgBB: <span id="imgbbKeyStatus" style="color: #00ff88;">–ù–∞—Å—Ç—Ä–æ–µ–Ω</span>
                    </p>
                </div>
                
                <form id="postForm">
                    <input type="hidden" id="postId" value="">
                    
                    <div class="form-group">
                        <label for="postTitle" class="form-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫*</label>
                        <input type="text" id="postTitle" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–æ—Å—Ç–∏" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="postDescription" class="form-label">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ*</label>
                        <textarea id="postDescription" class="form-textarea" placeholder="–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="postContent" class="form-label">–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <textarea id="postContent" class="form-textarea" placeholder="–ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—å–∏ —Å Markdown —Ä–∞–∑–º–µ—Ç–∫–æ–π"></textarea>
                    </div>
                    
                    <!-- –ü–æ–ª–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                    <div class="form-group">
                        <label for="postImages" class="form-label">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <input type="file" id="postImages" class="form-file" accept="image/*" multiple>
                        <span class="select-hint">–ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 32MB –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.</span>
                        
                        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
                        <div id="imagePreview" class="image-preview-container hidden">
                            <div class="image-preview-title">–ü—Ä–µ–≤—å—é –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:</div>
                            <div id="imagePreviewGrid" class="image-preview-grid"></div>
                            <div id="uploadProgress" class="upload-progress hidden">
                                <div id="uploadProgressBar" class="upload-progress-bar"></div>
                            </div>
                            <div id="uploadStatus" class="upload-status"></div>
                        </div>
                        
                        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ç–µ–∫—É—â–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (–ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏) -->
                        <div id="currentImages" class="image-preview-container hidden">
                            <div class="current-images-title">–¢–µ–∫—É—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</div>
                            <div id="currentImagesGrid" class="image-preview-grid"></div>
                        </div>
                    </div>
                    
                    <!-- –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
                    <div class="form-group">
                        <label for="postImageUrls" class="form-label">–ò–ª–∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (URL —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                        <input type="text" id="postImageUrls" class="form-input" placeholder="https://example.com/image1.jpg, https://example.com/image2.jpg">
                        <span class="select-hint">–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–±: –≤—Å—Ç–∞–≤—å—Ç–µ –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</span>
                    </div>
                    
                    <div class="form-group">
                        <label for="postUrl" class="form-label">–ò—Å—Ç–æ—á–Ω–∏–∫(-–∏) (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <input type="text" id="postUrl" class="form-input" placeholder="https://example.com/article, https://another.com/source (—Ä–∞–∑–¥–µ–ª—è–π—Ç–µ —Å—Å—ã–ª–∫–∏ –∑–∞–ø—è—Ç—ã–º–∏)">
                    </div>
                    
                    <div class="form-group">
                        <label for="postTags" class="form-label">–¢–µ–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <select id="postTags" class="form-select" multiple style="display: none;">
                            <option value="AI">AI</option>
                            <option value="IPhone">IPhone</option>
                            <option value="Android">Android</option>
                            <option value="Neuron Ecosystem">Neuron Ecosystem</option>
                            <option value="–≠–∫—Å–∫–ª—é–∑–∏–≤">–≠–∫—Å–∫–ª—é–∑–∏–≤</option>
                            <option value="–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞">–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞</option>
                            <option value="IT">IT</option>
                            <option value="–Ø–Ω–¥–µ–∫—Å">–Ø–Ω–¥–µ–∫—Å</option>
                            <option value="Google">Google</option>
                        </select>
                        <div id="tagsContainer" class="tags-container">
                            <!-- –¢–µ–≥–∏ –±—É–¥—É—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã JavaScript -->
                        </div>
                        <span class="select-hint">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Ç–µ–≥, —á—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –∏–ª–∏ –æ—Ç–º–µ–Ω–∏—Ç—å –≤—ã–±–æ—Ä</span>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" id="cancelEdit" class="btn btn-secondary hidden">
                            <i class="fas fa-times"></i> –û—Ç–º–µ–Ω–∞
                        </button>
                        <button type="submit" id="submitBtn" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i> –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                        </button>
                    </div>
                </form>

                <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –ø–æ—Å—Ç–∞–º–∏ -->
                <div id="postsManagement" class="posts-management hidden">
                    <h3 class="management-title">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–π</h3>
                    <div id="postsList" class="posts-list">
                        <div class="loader">
                            <i class="fas fa-spinner"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword, 
            signOut, 
            onAuthStateChanged,
            GoogleAuthProvider,
            signInWithPopup,
            signInWithRedirect,
            getRedirectResult
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            updateDoc,
            deleteDoc,
            doc,
            getDoc,
            getDocs,
            serverTimestamp, 
            query, 
            orderBy, 
            limit,
            where
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Firebase –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ Auth –∏ Firestore)
        const firebaseConfig = {
            apiKey: "AIzaSyDOaDVzzPjyYm4HWMND2XYWjLy_h4wty5s",
            authDomain: "neuron-ecosystem-2025.firebaseapp.com",
            projectId: "neuron-ecosystem-2025",
            storageBucket: "neuron-ecosystem-2025.firebasestorage.app",
            messagingSenderId: "589834476565",
            appId: "1:589834476565:web:cd5497b25b08aa66dd421c",
            measurementId: "G-T4XQY6L4BY"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // ========== ImgBB API –ö–ª—é—á ==========
        const IMGBB_API_KEY = "8f79008cc1cf4284a58a0a54f2988f23";
        // ====================================

        // –°–ø–∏—Å–æ–∫ –∞–¥–º–∏–Ω–æ–≤
        const allowedAdmins = [
            "test@test.ru"
        ];

        // –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Ç–µ–≥–∏
        const AVAILABLE_TAGS = [
            "AI",
            "IPhone", 
            "Android",
            "Neuron Ecosystem",
            "–≠–∫—Å–∫–ª—é–∑–∏–≤",
            "–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–∞",
            "IT",
            "–Ø–Ω–¥–µ–∫—Å",
            "Google"
        ];

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let currentPostToDelete = null;
        let isEditing = false;
        let currentArticleId = null;
        let selectedImages = [];
        let currentImageUrls = [];
        let currentUser = null;

        // ========== –†–û–£–¢–ï–† ==========
        const router = {
            init() {
                window.addEventListener('hashchange', () => this.handleRoute());
                this.handleRoute();
            },
            
            handleRoute() {
                const hash = window.location.hash.substring(1);
                const pages = document.querySelectorAll('.page');
                pages.forEach(page => page.classList.remove('active'));
                
                if (hash === '' || hash === '/') {
                    document.getElementById('homePage').classList.add('active');
                    loadNewsFeed();
                } else if (hash.startsWith('/admin')) {
                    if (currentUser && allowedAdmins.includes(currentUser.email)) {
                        document.getElementById('adminPage').classList.add('active');
                        initCustomTags();
                        loadPostsList();
                    } else {
                        this.navigate('/');
                        showNotification('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞', 'error');
                    }
                } else {
                    document.getElementById('articlePage').classList.add('active');
                    const slug = hash.substring(1);
                    loadArticle(slug);
                }
            },
            
            navigate(path) {
                window.location.hash = path;
            },
            
            getCurrentPath() {
                return window.location.hash.substring(1);
            }
        };

        // ========== –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ù–´–ï –ó–ê–ü–†–û–°–´ FIRESTORE ==========

        /**
         * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ª–µ–Ω—Ç—É –Ω–æ–≤–æ—Å—Ç–µ–π —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π (10 —Å–∞–º—ã—Ö —Å–≤–µ–∂–∏—Ö –ø–æ—Å—Ç–æ–≤)
         */
        async function loadNewsFeed() {
            const newsFeedContainer = document.getElementById('newsFeed');
            
            try {
                newsFeedContainer.innerHTML = `
                    <div class="loader">
                        <i class="fas fa-spinner"></i> –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π...
                    </div>
                `;

                const postsRef = collection(db, "posts");
                const q = query(
                    postsRef, 
                    orderBy("createdAt", "desc"), 
                    limit(10) // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–ª—å–∫–æ 10 –ø–æ—Å—Ç–æ–≤
                );

                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    newsFeedContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-newspaper"></i>
                            <p>–ü–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤–æ—Å—Ç–µ–π. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –æ–ø—É–±–ª–∏–∫—É–µ—Ç!</p>
                        </div>
                    `;
                    return;
                }

                let postsHtml = '';
                querySnapshot.forEach(doc => {
                    const post = doc.data();
                    const postId = doc.id;
                    const slug = generateSlug(post.title);
                    
                    // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –ø—Ä–µ–≤—å—é
                    const shortDescription = post.description.length > 150 
                        ? post.description.substring(0, 150) + '...' 
                        : post.description;
                    
                    postsHtml += `
                        <div class="post-card glass" data-id="${postId}" data-slug="${slug}">
                            ${post.images && post.images.length > 0 ? 
                                `<img src="${post.images[0]}" alt="${post.title}" class="post-image" loading="lazy">` 
                                : ''
                            }
                            <div class="post-content">
                                ${post.tags && post.tags.length > 0 ? 
                                    `<div class="post-tags">
                                        ${post.tags.slice(0, 3).map(tag => `<span class="tag">${tag}</span>`).join('')}
                                    </div>` 
                                    : ''
                                }
                                <h2 class="post-title">
                                    <a href="#/${slug}" onclick="event.stopPropagation(); router.navigate('/${slug}'); return false;">
                                        ${post.title}
                                    </a>
                                </h2>
                                <p class="post-description">${shortDescription}</p>
                                <div class="post-meta">
                                    <span>${formatDate(post.createdAt)}</span>
                                    <a href="#/${slug}" onclick="event.stopPropagation(); router.navigate('/${slug}'); return false;" class="read-more">
                                        –ß–∏—Ç–∞—Ç—å –¥–∞–ª–µ–µ <i class="fas fa-arrow-right"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    `;
                });

                newsFeedContainer.innerHTML = postsHtml;

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º
                document.querySelectorAll('.post-card').forEach(card => {
                    card.addEventListener('click', function(e) {
                        if (!e.target.closest('a') && !e.target.closest('button')) {
                            const slug = this.getAttribute('data-slug');
                            router.navigate(`/${slug}`);
                        }
                    });
                });

            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–µ–Ω—Ç—ã:", error);
                newsFeedContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π</p>
                        <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ</p>
                    </div>
                `;
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π', 'error');
            }
        }

        /**
         * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—Ç–∞—Ç—å—é –ø–æ slug —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–∏—Å–∫–æ–º
         */
        async function loadArticle(slug) {
            const articleContent = document.getElementById('articleContent');
            
            try {
                articleContent.innerHTML = `
                    <div class="loader">
                        <i class="fas fa-spinner"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç—å–∏...
                    </div>
                `;

                if (!slug || slug === 'undefined') {
                    throw new Error('–°—Ç–∞—Ç—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                }

                const postsRef = collection(db, "posts");
                
                // –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –ø–æ–∏—Å–∫ –ø–æ –ø–æ–ª—é slug (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö)
                // –ï—Å–ª–∏ –ø–æ–ª–µ slug –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–∏—Å–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É
                const q = query(postsRef, where("slug", "==", slug));
                
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫: –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É
                    const titleQuery = query(
                        postsRef, 
                        where("title", "==", decodeURIComponent(slug).replace(/-/g, ' '))
                    );
                    const titleSnapshot = await getDocs(titleQuery);
                    
                    if (titleSnapshot.empty) {
                        throw new Error('–°—Ç–∞—Ç—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                    }
                    
                    const doc = titleSnapshot.docs[0];
                    displayArticle(doc.data(), doc.id);
                } else {
                    const doc = querySnapshot.docs[0];
                    displayArticle(doc.data(), doc.id);
                }

            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç—å–∏:", error);
                articleContent.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>${error.message}</p>
                        <button class="btn btn-secondary" onclick="router.navigate('/')" style="margin-top: 20px;">
                            <i class="fas fa-arrow-left"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                        </button>
                    </div>
                `;
            }
        }

        /**
         * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—É—é —Å—Ç–∞—Ç—å—é
         */
        function displayArticle(post, postId) {
            const articleContent = document.getElementById('articleContent');
            currentArticleId = postId;

            const isAdmin = currentUser && allowedAdmins.includes(currentUser.email);
            
            let adminActions = '';
            if (isAdmin) {
                adminActions = `
                    <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                        <h4>–î–µ–π—Å—Ç–≤–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</h4>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button class="btn btn-warning" onclick="editPost('${postId}')">
                                <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button class="btn btn-danger" onclick="deletePostPrompt('${postId}')">
                                <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                `;
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∏—Å—Ç–æ—á–Ω–∏–∫–∏
            let sourcesHtml = '';
            if (post.url) {
                const urls = Array.isArray(post.url) ? post.url : [post.url];
                sourcesHtml = `
                    <div class="sources" style="margin-top: 30px;">
                        <h4>–ò—Å—Ç–æ—á–Ω–∏–∫–∏:</h4>
                        <ul style="margin-top: 10px;">
                            ${urls.map(url => `
                                <li style="margin-bottom: 5px;">
                                    <a href="${url}" target="_blank" rel="noopener noreferrer" 
                                       style="color: var(--accent-color); text-decoration: none;">
                                        <i class="fas fa-external-link-alt"></i> ${url}
                                    </a>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                `;
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ç–µ–≥–∏
            let tagsHtml = '';
            if (post.tags && post.tags.length > 0) {
                tagsHtml = `
                    <div class="post-tags" style="margin: 20px 0;">
                        ${post.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                `;
            }

            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            let imagesHtml = '';
            if (post.images && post.images.length > 0) {
                if (post.images.length === 1) {
                    imagesHtml = `
                        <div style="margin: 20px 0;">
                            <img src="${post.images[0]}" alt="${post.title}" 
                                 style="width: 100%; border-radius: 12px; max-height: 500px; object-fit: cover;">
                        </div>
                    `;
                } else {
                    imagesHtml = `
                        <div style="margin: 20px 0;">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                                ${post.images.map(img => `
                                    <img src="${img}" alt="${post.title}" 
                                         style="width: 100%; height: 200px; object-fit: cover; border-radius: 8px;">
                                `).join('')}
                            </div>
                        </div>
                    `;
                }
            }

            articleContent.innerHTML = `
                <div class="article-meta">
                    <div class="article-date">
                        <i class="far fa-calendar"></i> ${formatDate(post.createdAt)}
                    </div>
                    <button class="btn btn-secondary" onclick="router.navigate('/')">
                        <i class="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ –ª–µ–Ω—Ç–µ
                    </button>
                </div>
                
                <h1 class="article-title">${post.title}</h1>
                
                ${tagsHtml}
                ${imagesHtml}
                
                <div class="article-content">
                    ${post.content ? post.content.replace(/\n/g, '<br>') : post.description.replace(/\n/g, '<br>')}
                </div>
                
                ${sourcesHtml}
                ${adminActions}
                
                <div id="commentsSection" class="comments-section">
                    <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
                </div>
            `;

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
            loadComments(postId);
        }

        // ========== –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò ==========

        /**
         * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ø–æ—Å—Ç–∞
         */
        async function loadComments(postId) {
            const commentsSection = document.getElementById('commentsSection');
            if (!commentsSection) return;

            try {
                const commentsRef = collection(db, "comments");
                const q = query(
                    commentsRef, 
                    where("postId", "==", postId),
                    orderBy("createdAt", "desc")
                );

                const querySnapshot = await getDocs(q);
                const comments = [];
                
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    comments.push({
                        id: doc.id,
                        ...data
                    });
                });

                const isAuthenticated = !!currentUser;
                
                // –§–æ—Ä–º–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
                let commentFormHtml = '';
                if (isAuthenticated) {
                    commentFormHtml = `
                        <div class="comment-form">
                            <textarea id="commentText" class="comment-input" 
                                      placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π..." rows="3"></textarea>
                            <div class="comment-form-footer">
                                <div class="comment-count">${comments.length} –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
                                <button id="submitCommentBtn" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    commentFormHtml = `
                        <div class="comment-form">
                            <div style="text-align: center; padding: var(--spacing-md); background: rgba(255, 255, 255, 0.03); border-radius: var(--border-radius);">
                                <p style="margin-bottom: var(--spacing-sm);">
                                    –ß—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, 
                                    <a href="javascript:void(0)" onclick="openAuthModal()" style="color: var(--accent-color); text-decoration: none;">
                                        –≤–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å
                                    </a>
                                </p>
                                <button onclick="openAuthModal()" class="btn btn-primary">
                                    <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏ / –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
                                </button>
                            </div>
                            <div class="comment-form-footer">
                                <div class="comment-count">${comments.length} –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</div>
                            </div>
                        </div>
                    `;
                }

                // –°–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
                let commentsListHtml = '';
                if (comments.length === 0) {
                    commentsListHtml = `
                        <div class="empty-comments">
                            <i class="far fa-comments"></i>
                            <p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
                        </div>
                    `;
                } else {
                    commentsListHtml = `
                        <div class="comments-list">
                            ${comments.map(comment => {
                                const canDelete = (currentUser && allowedAdmins.includes(currentUser.email)) || 
                                                (currentUser && currentUser.uid === comment.userId);
                                return `
                                    <div class="comment-item" id="comment-${comment.id}">
                                        <div class="comment-header">
                                            <div class="comment-author">
                                                <div class="comment-avatar">${getInitials(comment.userEmail)}</div>
                                                <div class="comment-author-info">
                                                    <div class="comment-author-name">${comment.userEmail.split('@')[0]}</div>
                                                    <div class="comment-author-email">${comment.userEmail}</div>
                                                </div>
                                            </div>
                                            <div class="comment-date">${formatCommentDate(comment.createdAt)}</div>
                                        </div>
                                        <div class="comment-content">${comment.content.replace(/\n/g, '<br>')}</div>
                                        ${canDelete ? `
                                            <div class="comment-actions">
                                                <button class="comment-action-btn delete" 
                                                        onclick="deleteComment('${comment.id}')">
                                                    <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                                </button>
                                            </div>
                                        ` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }

                commentsSection.innerHTML = `
                    <h3 class="comments-title">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
                    ${commentFormHtml}
                    ${commentsListHtml}
                `;

                // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
                if (isAuthenticated) {
                    const submitBtn = document.getElementById('submitCommentBtn');
                    if (submitBtn) {
                        submitBtn.addEventListener('click', submitComment);
                    }
                }

            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:", error);
                
                let errorMessage = '';
                if (error.code === 'failed-precondition') {
                    errorMessage = `
                        <div class="index-error">
                            <h4>–¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å</h4>
                            <p>–î–ª—è —Ä–∞–±–æ—Ç—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å –≤ Firebase Console.</p>
                            <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Firestore ‚Üí Indexes –∏ —Å–æ–∑–¥–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å –¥–ª—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏ "comments" 
                               —Å –ø–æ–ª—è–º–∏: postId (Ascending), createdAt (Descending).</p>
                        </div>
                    `;
                } else {
                    errorMessage = `
                        <div class="empty-comments">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</p>
                        </div>
                    `;
                }
                
                commentsSection.innerHTML = `
                    <h3 class="comments-title">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
                    ${errorMessage}
                `;
            }
        }

        /**
         * –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
         */
        async function submitComment() {
            try {
                const commentText = document.getElementById('commentText');
                const text = commentText.value.trim();
                
                if (!text) {
                    showNotification('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è', 'error');
                    return;
                }
                
                if (!currentUser) {
                    showNotification('–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
                    openAuthModal();
                    return;
                }
                
                if (!currentArticleId) {
                    showNotification('–û—à–∏–±–∫–∞: —Å—Ç–∞—Ç—å—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞', 'error');
                    return;
                }
                
                await addDoc(collection(db, "comments"), {
                    postId: currentArticleId,
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    content: text,
                    createdAt: serverTimestamp()
                });
                
                commentText.value = '';
                showNotification('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
                
                // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
                loadComments(currentArticleId);
                
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:", error);
                showNotification('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è', 'error');
            }
        }

        /**
         * –£–¥–∞–ª—è–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
         */
        async function deleteComment(commentId) {
            try {
                if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π?')) {
                    return;
                }
                
                await deleteDoc(doc(db, "comments", commentId));
                showNotification('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É–¥–∞–ª–µ–Ω', 'success');
                
                // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç –∏–∑ DOM
                const commentElement = document.getElementById(`comment-${commentId}`);
                if (commentElement) {
                    commentElement.remove();
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
                const commentCount = document.querySelector('.comment-count');
                if (commentCount) {
                    const currentCount = parseInt(commentCount.textContent) || 0;
                    commentCount.textContent = `${Math.max(0, currentCount - 1)} –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤`;
                }
                
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è:", error);
                showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è', 'error');
            }
        }

        // ========== IMGBB –ó–ê–ì–†–£–ó–ö–ê –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô ==========

        /**
         * –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É ImgBB API –∫–ª—é—á–∞
         */
        function checkImgBBKey() {
            const keyStatus = document.getElementById('imgbbKeyStatus');
            if (!keyStatus) return false;
            
            if (!IMGBB_API_KEY || IMGBB_API_KEY === "8f79008cc1cf4284a58a0a54f2988f23") {
                keyStatus.textContent = "–ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω";
                keyStatus.style.color = "#ff5555";
                return false;
            }
            
            keyStatus.textContent = "–ù–∞—Å—Ç—Ä–æ–µ–Ω";
            keyStatus.style.color = "#00ff88";
            return true;
        }

        /**
         * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ ImgBB
         */
        async function uploadToImgBB(file) {
            if (!IMGBB_API_KEY) {
                throw new Error("API –∫–ª—é—á ImgBB –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω");
            }
            
            const formData = new FormData();
            formData.append('image', file);
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º POST –º–µ—Ç–æ–¥ –∫–∞–∫ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ImgBB
                const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    return data.data.url;
                } else {
                    throw new Error(data.error?.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ ImgBB');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤ ImgBB:', error);
                throw error;
            }
        }

        /**
         * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ ImgBB
         */
        async function uploadImages() {
            if (!selectedImages || selectedImages.length === 0) {
                return [];
            }
            
            if (!checkImgBBKey()) {
                showNotification('API –∫–ª—é—á ImgBB –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.', 'error');
                return [];
            }
            
            const uploadProgress = document.getElementById('uploadProgress');
            const uploadProgressBar = document.getElementById('uploadProgressBar');
            const uploadStatus = document.getElementById('uploadStatus');
            
            uploadProgress.classList.remove('hidden');
            uploadProgressBar.style.width = '0%';
            uploadStatus.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ ImgBB...';
            
            const uploadedUrls = [];
            const totalImages = selectedImages.length;
            
            for (let i = 0; i < selectedImages.length; i++) {
                const file = selectedImages[i];
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–¥–æ 32MB)
                if (file.size > 32 * 1024 * 1024) {
                    showNotification(`–§–∞–π–ª "${file.name}" —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å–∏–º—É–º 32MB)`, 'error');
                    continue;
                }
                
                try {
                    const progress = Math.round(((i + 1) / totalImages) * 100);
                    uploadProgressBar.style.width = `${progress}%`;
                    uploadStatus.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${i + 1} –∏–∑ ${totalImages} –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π`;
                    
                    const imageUrl = await uploadToImgBB(file);
                    uploadedUrls.push(imageUrl);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', error);
                    showNotification(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è "${file.name}"`, 'error');
                    continue;
                }
            }
            
            // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            setTimeout(() => {
                uploadProgress.classList.add('hidden');
                uploadStatus.textContent = '';
            }, 1000);
            
            return uploadedUrls;
        }

        /**
         * –ü–∞—Ä—Å–∏—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ —Å—Ç—Ä–æ–∫–∏
         */
        function parseImageUrls(urlInput) {
            if (!urlInput || typeof urlInput !== 'string') return [];
            
            return urlInput
                .split(',')
                .map(url => url.trim())
                .filter(url => {
                    if (!url.startsWith('http://') && !url.startsWith('https://')) return false;
                    const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.bmp', '.svg'];
                    const urlLower = url.toLowerCase();
                    return imageExtensions.some(ext => urlLower.includes(ext));
                });
        }

        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
         */
        function initImageUpload() {
            const imageInput = document.getElementById('postImages');
            if (!imageInput) return;
            
            imageInput.addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                selectedImages = [];
                const imagePreviewGrid = document.getElementById('imagePreviewGrid');
                const imagePreview = document.getElementById('imagePreview');
                
                imagePreviewGrid.innerHTML = '';
                
                if (files.length === 0) {
                    imagePreview.classList.add('hidden');
                    return;
                }
                
                let validFiles = [];
                
                files.forEach(file => {
                    if (file.size > 32 * 1024 * 1024) {
                        showNotification(`–§–∞–π–ª "${file.name}" –ø—Ä–µ–≤—ã—à–∞–µ—Ç 32MB`, 'error');
                    } else {
                        validFiles.push(file);
                    }
                });
                
                if (validFiles.length === 0) {
                    imagePreview.classList.add('hidden');
                    return;
                }
                
                selectedImages = validFiles;
                
                validFiles.forEach((file, index) => {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const previewItem = document.createElement('div');
                        previewItem.className = 'image-preview-item';
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" alt="–ü—Ä–µ–≤—å—é ${index + 1}">
                            <button type="button" class="image-preview-remove" data-index="${index}">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                        imagePreviewGrid.appendChild(previewItem);
                        
                        const removeBtn = previewItem.querySelector('.image-preview-remove');
                        removeBtn.addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            removeImagePreview(index);
                        });
                    };
                    
                    reader.readAsDataURL(file);
                });
                
                imagePreview.classList.remove('hidden');
            });
        }

        /**
         * –£–¥–∞–ª—è–µ—Ç –ø—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
         */
        function removeImagePreview(index) {
            selectedImages.splice(index, 1);
            
            const dataTransfer = new DataTransfer();
            selectedImages.forEach(file => {
                dataTransfer.items.add(file);
            });
            document.getElementById('postImages').files = dataTransfer.files;
            
            const imagePreviewGrid = document.getElementById('imagePreviewGrid');
            imagePreviewGrid.innerHTML = '';
            
            if (selectedImages.length === 0) {
                document.getElementById('imagePreview').classList.add('hidden');
                return;
            }
            
            selectedImages.forEach((file, newIndex) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'image-preview-item';
                    previewItem.innerHTML = `
                        <img src="${e.target.result}" alt="–ü—Ä–µ–≤—å—é ${newIndex + 1}">
                        <button type="button" class="image-preview-remove" data-index="${newIndex}">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    imagePreviewGrid.appendChild(previewItem);
                    
                    const removeBtn = previewItem.querySelector('.image-preview-remove');
                    removeBtn.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        removeImagePreview(index);
                    });
                };
                
                reader.readAsDataURL(file);
            });
        }

        /**
         * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏)
         */
        function showCurrentImages(imageUrls) {
            const currentImagesContainer = document.getElementById('currentImages');
            const currentImagesGrid = document.getElementById('currentImagesGrid');
            
            if (!imageUrls || !Array.isArray(imageUrls) || imageUrls.length === 0) {
                currentImagesContainer.classList.add('hidden');
                return;
            }
            
            currentImageUrls = [...imageUrls];
            currentImagesGrid.innerHTML = '';
            
            imageUrls.forEach((url, index) => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-preview-item';
                imageItem.innerHTML = `
                    <img src="${url}" alt="–¢–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ${index + 1}">
                    <button type="button" class="image-preview-remove" data-url="${url}">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                currentImagesGrid.appendChild(imageItem);
                
                const removeBtn = imageItem.querySelector('.image-preview-remove');
                removeBtn.addEventListener('click', function() {
                    const urlToDelete = this.getAttribute('data-url');
                    removeCurrentImage(urlToDelete);
                });
            });
            
            currentImagesContainer.classList.remove('hidden');
        }

        /**
         * –£–¥–∞–ª—è–µ—Ç —Ç–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
         */
        function removeCurrentImage(url) {
            const index = currentImageUrls.indexOf(url);
            if (index > -1) {
                currentImageUrls.splice(index, 1);
            }
            
            showCurrentImages(currentImageUrls);
            showNotification('–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ –∏–∑ –Ω–æ–≤–æ—Å—Ç–∏', 'warning');
        }

        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–ï–ì–ê–ú–ò ==========

        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–µ–≥–∏
         */
        function initCustomTags() {
            const tagsContainer = document.getElementById('tagsContainer');
            if (!tagsContainer) return;
            
            tagsContainer.innerHTML = '';
            
            AVAILABLE_TAGS.forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag-option';
                tagElement.textContent = tag;
                tagElement.dataset.value = tag;
                
                tagElement.addEventListener('click', function() {
                    this.classList.toggle('selected');
                    updateHiddenSelect();
                });
                
                tagsContainer.appendChild(tagElement);
            });
        }

        /**
         * –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–∫—Ä—ã—Ç—ã–π select —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ —Ç–µ–≥–∞–º–∏
         */
        function updateHiddenSelect() {
            const tagsSelect = document.getElementById('postTags');
            const selectedTags = getSelectedCustomTags();
            
            for (let option of tagsSelect.options) {
                option.selected = false;
            }
            
            selectedTags.forEach(tag => {
                for (let option of tagsSelect.options) {
                    if (option.value === tag) {
                        option.selected = true;
                        break;
                    }
                }
            });
        }

        /**
         * –ü–æ–ª—É—á–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Ç–µ–≥–∏
         */
        function getSelectedCustomTags() {
            const selectedTags = [];
            const tagOptions = document.querySelectorAll('.tag-option.selected');
            
            tagOptions.forEach(option => {
                selectedTags.push(option.dataset.value);
            });
            
            return selectedTags;
        }

        /**
         * –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–µ–≥–∏
         */
        function setSelectedCustomTags(tags) {
            if (!tags) return;
            
            let tagArray = [];
            if (Array.isArray(tags)) {
                tagArray = tags;
            } else if (typeof tags === 'string') {
                tagArray = tags.split(',').map(tag => tag.trim()).filter(tag => tag.length > 0);
            }
            
            const tagOptions = document.querySelectorAll('.tag-option');
            tagOptions.forEach(option => {
                option.classList.remove('selected');
            });
            
            tagArray.forEach(tag => {
                const tagOption = document.querySelector(`.tag-option[data-value="${tag}"]`);
                if (tagOption) {
                    tagOption.classList.add('selected');
                }
            });
            
            updateHiddenSelect();
        }

        /**
         * –ü–æ–ª—É—á–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—ã–µ —Ç–µ–≥–∏
         */
        function getSelectedTags() {
            return getSelectedCustomTags();
        }

        // ========== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–°–¢–ê–ú–ò (CRUD) ==========

        /**
         * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
         */
        async function loadPostsList() {
            try {
                const postsQuery = query(collection(db, "posts"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(postsQuery);
                
                const postsList = document.getElementById('postsList');
                
                if (querySnapshot.empty) {
                    postsList.innerHTML = `
                        <div class="empty-state">
                            <p>–ù–µ—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                querySnapshot.forEach(doc => {
                    const data = doc.data();
                    const tagsHtml = data.tags && data.tags.length > 0 
                        ? `<div class="post-tags">
                            ${data.tags.slice(0, 3).map(tag => `<span class="post-tag">${tag}</span>`).join('')}
                           </div>`
                        : '';
                    
                    const imagesCount = data.images && Array.isArray(data.images) ? data.images.length : 0;
                    const imagesCountHtml = imagesCount > 0 
                        ? `<span class="post-images-count">${imagesCount} —Ñ–æ—Ç–æ</span>` 
                        : '';
                    
                    html += `
                        <div class="post-item" id="post-item-${doc.id}">
                            <div class="post-info">
                                <div class="post-title">
                                    ${data.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'} ${imagesCountHtml}
                                </div>
                                <div class="post-date">${formatShortDate(data.createdAt)}</div>
                                ${tagsHtml}
                            </div>
                            <div class="post-actions">
                                <button class="btn btn-warning" onclick="editPost('${doc.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-danger" onclick="deletePostPrompt('${doc.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                postsList.innerHTML = html;
                
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –ø–æ—Å—Ç–æ–≤:", error);
                document.getElementById('postsList').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π</p>
                    </div>
                `;
            }
        }

        /**
         * –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –ø–æ—Å—Ç
         */
        async function editPost(postId) {
            try {
                const postRef = doc(db, "posts", postId);
                const postDoc = await getDoc(postRef);
                
                if (postDoc.exists()) {
                    const data = postDoc.data();
                    
                    isEditing = true;
                    document.getElementById('postId').value = postId;
                    document.getElementById('postTitle').value = data.title || '';
                    document.getElementById('postDescription').value = data.description || '';
                    document.getElementById('postContent').value = data.content || '';
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º URL
                    let urlValue = '';
                    if (data.url) {
                        if (Array.isArray(data.url)) {
                            urlValue = data.url.join(', ');
                        } else {
                            urlValue = data.url;
                        }
                    }
                    document.getElementById('postUrl').value = urlValue;
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                    let imageUrlsValue = '';
                    if (data.images && Array.isArray(data.images)) {
                        imageUrlsValue = data.images.join(', ');
                    }
                    document.getElementById('postImageUrls').value = imageUrlsValue;
                    
                    setSelectedCustomTags(data.tags || []);
                    showCurrentImages(data.images || []);
                    
                    document.getElementById('formTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é';
                    document.getElementById('submitBtn').innerHTML = '<i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
                    document.getElementById('cancelEdit').classList.remove('hidden');
                    document.getElementById('postsManagement').classList.add('hidden');
                    
                    router.navigate('/admin');
                    
                    showNotification('–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∫–ª—é—á–µ–Ω', 'warning');
                } else {
                    showNotification('–ü–æ—Å—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:", error);
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å—Ç–∞', 'error');
            }
        }

        /**
         * –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞
         */
        function deletePostPrompt(postId) {
            currentPostToDelete = postId;
            openDeleteModal();
        }

        /**
         * –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞
         */
        async function confirmDelete() {
            if (!currentPostToDelete) return;
            
            try {
                await deleteDoc(doc(db, "posts", currentPostToDelete));
                
                // –£–¥–∞–ª—è–µ–º –∏–∑ —Å–ø–∏—Å–∫–∞ –≤ –∞–¥–º–∏–Ω–∫–µ
                const postElement = document.getElementById(`post-item-${currentPostToDelete}`);
                if (postElement) {
                    postElement.remove();
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–µ–Ω—Ç—É –Ω–æ–≤–æ—Å—Ç–µ–π
                loadNewsFeed();
                
                closeDeleteModal();
                showNotification('–ù–æ–≤–æ—Å—Ç—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞', 'success');
                
                // –ï—Å–ª–∏ –º—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —É–¥–∞–ª–µ–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–∏, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ –≥–ª–∞–≤–Ω—É—é
                if (router.getCurrentPath() !== '/' && router.getCurrentPath() !== '') {
                    const currentSlug = router.getCurrentPath().substring(1);
                    const currentPost = await findPostBySlug(currentSlug);
                    if (!currentPost || currentPost.id === currentPostToDelete) {
                        router.navigate('/');
                    }
                }
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞:", error);
                showNotification('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–∏', 'error');
            }
        }

        /**
         * –ò—â–µ—Ç –ø–æ—Å—Ç –ø–æ slug
         */
        async function findPostBySlug(slug) {
            try {
                const postsRef = collection(db, "posts");
                const q = query(postsRef, where("slug", "==", slug));
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    const doc = querySnapshot.docs[0];
                    return { id: doc.id, ...doc.data() };
                }
                
                return null;
            } catch (error) {
                console.error("–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ –ø–æ—Å—Ç–∞:", error);
                return null;
            }
        }

        /**
         * –°–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Ñ–æ—Ä–º—É
         */
        function resetForm() {
            isEditing = false;
            selectedImages = [];
            currentImageUrls = [];
            
            document.getElementById('postForm').reset();
            document.getElementById('postId').value = '';
            document.getElementById('formTitle').textContent = '–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –ø—É–±–ª–∏–∫–∞—Ü–∏—é';
            document.getElementById('submitBtn').innerHTML = '<i class="fas fa-paper-plane"></i> –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å';
            document.getElementById('cancelEdit').classList.add('hidden');
            document.getElementById('postsManagement').classList.remove('hidden');
            document.getElementById('imagePreview').classList.add('hidden');
            document.getElementById('currentImages').classList.add('hidden');
            document.getElementById('imagePreviewGrid').innerHTML = '';
            document.getElementById('currentImagesGrid').innerHTML = '';
            
            const tagOptions = document.querySelectorAll('.tag-option');
            tagOptions.forEach(option => {
                option.classList.remove('selected');
            });
            
            updateHiddenSelect();
        }

        // ========== –ê–£–¢–ï–ù–¢–ò–§–ò–ö–ê–¶–ò–Ø ==========

        /**
         * –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
         */
        function openAuthModal() {
            document.getElementById('authModal').classList.add('active');
        }

        /**
         * –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
         */
        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
            document.getElementById('loginForm').reset();
            document.getElementById('registerForm').reset();
        }

        /**
         * –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è
         */
        function openDeleteModal() {
            document.getElementById('deleteModal').classList.add('active');
        }

        /**
         * –ó–∞–∫—Ä—ã–≤–∞–µ—Ç –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è
         */
        function closeDeleteModal() {
            document.getElementById('deleteModal').classList.remove('active');
            currentPostToDelete = null;
        }

        // ========== –£–¢–ò–õ–ò–¢–´ ==========

        /**
         * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
         */
        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `glass notification ${type}`;
            
            let icon = 'fa-check-circle';
            if (type === 'error') icon = 'fa-exclamation-circle';
            if (type === 'warning') icon = 'fa-exclamation-triangle';
            
            notification.innerHTML = `
                <i class="fas ${icon}"></i>
                ${message}
            `;
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideInRight 0.3s ease-out reverse';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        /**
         * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–∞—Ç—É
         */
        function formatDate(timestamp) {
            if (!timestamp) return '–î–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞';
            try {
                const date = timestamp.toDate();
                return new Intl.DateTimeFormat('ru-RU', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                }).format(date);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã:', error);
                return '–î–∞—Ç–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞';
            }
        }

        /**
         * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ—Ä–æ—Ç–∫—É—é –¥–∞—Ç—É
         */
        function formatShortDate(timestamp) {
            if (!timestamp) return '';
            try {
                const date = timestamp.toDate();
                return new Intl.DateTimeFormat('ru-RU', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                }).format(date);
            } catch (error) {
                return '';
            }
        }

        /**
         * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –¥–∞—Ç—É –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
         */
        function formatCommentDate(timestamp) {
            if (!timestamp) return '';
            try {
                const date = timestamp.toDate();
                const now = new Date();
                const diff = now - date;
                
                if (diff < 60000) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
                if (diff < 3600000) {
                    const minutes = Math.floor(diff / 60000);
                    return `${minutes} ${getRussianWord(minutes, ['–º–∏–Ω—É—Ç—É', '–º–∏–Ω—É—Ç—ã', '–º–∏–Ω—É—Ç'])} –Ω–∞–∑–∞–¥`;
                }
                if (diff < 86400000) {
                    const hours = Math.floor(diff / 3600000);
                    return `${hours} ${getRussianWord(hours, ['—á–∞—Å', '—á–∞—Å–∞', '—á–∞—Å–æ–≤'])} –Ω–∞–∑–∞–¥`;
                }
                if (diff < 604800000) {
                    const days = Math.floor(diff / 86400000);
                    return `${days} ${getRussianWord(days, ['–¥–µ–Ω—å', '–¥–Ω—è', '–¥–Ω–µ–π'])} –Ω–∞–∑–∞–¥`;
                }
                
                return new Intl.DateTimeFormat('ru-RU', {
                    day: 'numeric',
                    month: 'short',
                    year: 'numeric'
                }).format(date);
            } catch (error) {
                return '';
            }
        }

        /**
         * –ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ñ–æ—Ä–º—É —Å–ª–æ–≤–∞ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
         */
        function getRussianWord(number, words) {
            const cases = [2, 0, 1, 1, 1, 2];
            return words[(number % 100 > 4 && number % 100 < 20) ? 2 : cases[(number % 10 < 5) ? number % 10 : 5]];
        }

        /**
         * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç slug –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
         */
        function generateSlug(title) {
            if (!title || typeof title !== 'string') {
                return 'untitled-' + Date.now();
            }
            return title
                .toLowerCase()
                .replace(/[^\w\s\u0400-\u04FF]/g, '') // –†–∞–∑—Ä–µ—à–∞–µ–º –∫–∏—Ä–∏–ª–ª–∏—Ü—É
                .replace(/\s+/g, '-')
                .replace(/--+/g, '-')
                .trim();
        }

        /**
         * –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª—ã –∏–∑ email
         */
        function getInitials(email) {
            if (!email) return '?';
            const name = email.split('@')[0];
            if (name.length >= 2) {
                return name.substring(0, 2).toUpperCase();
            }
            return name.charAt(0).toUpperCase();
        }

        /**
         * –ü–∞—Ä—Å–∏—Ç URL –∏–∑ —Å—Ç—Ä–æ–∫–∏
         */
        function parseUrls(urlInput) {
            if (!urlInput || typeof urlInput !== 'string') return [];
            
            return urlInput
                .split(',')
                .map(url => url.trim())
                .filter(url => url.length > 0 && (url.startsWith('http://') || url.startsWith('https://')));
        }

        // ========== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ==========

        /**
         * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
         */
        function initApp() {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ä–æ—É—Ç–µ—Ä —Å—Ä–∞–∑—É
            router.init();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º ImgBB –∫–ª—é—á
            checkImgBBKey();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
            document.getElementById('authBtn').addEventListener('click', openAuthModal);
            document.getElementById('adminBtn').addEventListener('click', () => router.navigate('/admin'));
            
            document.getElementById('logoutBtn').addEventListener('click', async () => {
                try {
                    await signOut(auth);
                    showNotification('–í—ã —É—Å–ø–µ—à–Ω–æ –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã');
                    closeAuthModal();
                } catch (error) {
                    showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ: ' + error.message, 'error');
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
            document.getElementById('deleteModalClose').addEventListener('click', closeDeleteModal);
            document.getElementById('deleteModalCancel').addEventListener('click', closeDeleteModal);
            document.getElementById('deleteModalConfirm').addEventListener('click', confirmDelete);
            document.getElementById('authModalClose').addEventListener('click', closeAuthModal);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–∫–ª–∞–¥–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
            document.querySelectorAll('.auth-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    document.querySelectorAll('.auth-tab').forEach(t => {
                        t.classList.remove('active');
                    });
                    
                    this.classList.add('active');
                    
                    document.querySelectorAll('.auth-form').forEach(form => {
                        form.classList.remove('active');
                    });
                    
                    document.getElementById(`${tabId}Form`).classList.add('active');
                });
            });
            
            // –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
            document.getElementById('loginForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    showNotification('–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                    closeAuthModal();
                    document.getElementById('loginForm').reset();
                } catch (error) {
                    showNotification('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message, 'error');
                }
            });
            
            // –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            document.getElementById('registerForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                const confirmPassword = document.getElementById('registerConfirmPassword').value;
                
                if (password !== confirmPassword) {
                    showNotification('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç', 'error');
                    return;
                }
                
                if (password.length < 6) {
                    showNotification('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                    return;
                }
                
                try {
                    await createUserWithEmailAndPassword(auth, email, password);
                    showNotification('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
                    closeAuthModal();
                    document.getElementById('registerForm').reset();
                } catch (error) {
                    showNotification('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message, 'error');
                }
            });
            
            // –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google
            document.getElementById('googleLoginBtn').addEventListener('click', async () => {
                try {
                    await signInWithPopup(auth, googleProvider);
                    showNotification('–í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                    closeAuthModal();
                } catch (error) {
                    console.error("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google:", error);
                    if (error.code === 'auth/unauthorized-domain') {
                        showNotification('–î–æ–º–µ–Ω –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –¥–ª—è OAuth. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–º–µ–Ω –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Firebase.', 'error');
                    } else {
                        showNotification('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google: ' + error.message, 'error');
                    }
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç redirect –¥–ª—è Google
            getRedirectResult(auth).then((result) => {
                if (result) {
                    showNotification('–í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
                    closeAuthModal();
                }
            }).catch((error) => {
                console.error("–û—à–∏–±–∫–∞ redirect:", error);
            });
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            initImageUpload();
            
            // –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ—Å—Ç–∞
            document.getElementById('postForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const postId = document.getElementById('postId').value;
                const title = document.getElementById('postTitle').value.trim();
                const description = document.getElementById('postDescription').value.trim();
                const content = document.getElementById('postContent').value.trim();
                const urlInput = document.getElementById('postUrl').value.trim();
                const imageUrlsInput = document.getElementById('postImageUrls').value.trim();
                const selectedTags = getSelectedTags();
                
                // –í–∞–ª–∏–¥–∞—Ü–∏—è
                if (!title || title.length < 3) {
                    showNotification('–ó–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 3 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                    return;
                }
                
                if (!description || description.length < 10) {
                    showNotification('–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 10 —Å–∏–º–≤–æ–ª–æ–≤', 'error');
                    return;
                }
                
                const urls = parseUrls(urlInput);
                const invalidUrls = urls.filter(url => !url.startsWith('http://') || !url.startsWith('https://'));
                if (invalidUrls.length > 0) {
                    showNotification('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å—Å—ã–ª–∫–∏. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å http:// –∏–ª–∏ https://', 'error');
                    return;
                }
                
                const urlData = urls.length > 0 ? urls : '';
                
                try {
                    let imagesData = [];
                    
                    // 1. –°–æ–±–∏—Ä–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ —Å—Å—ã–ª–æ–∫
                    const parsedImageUrls = parseImageUrls(imageUrlsInput);
                    imagesData = [...parsedImageUrls];
                    
                    // 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ ImgBB
                    if (selectedImages.length > 0) {
                        const uploadedUrls = await uploadImages();
                        imagesData = [...imagesData, ...uploadedUrls];
                    }
                    
                    // 3. –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏)
                    if (isEditing && currentImageUrls.length > 0) {
                        imagesData = [...imagesData, ...currentImageUrls];
                        imagesData = [...new Set(imagesData)]; // –£–¥–∞–ª—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
                    }
                    
                    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º slug
                    const slug = generateSlug(title);
                    
                    if (isEditing && postId) {
                        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ—Å—Ç–∞
                        await updateDoc(doc(db, "posts", postId), {
                            title,
                            description,
                            content: content || description,
                            url: urlData,
                            images: imagesData,
                            tags: selectedTags,
                            slug: slug
                        });
                        
                        showNotification('–ù–æ–≤–æ—Å—Ç—å —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞!', 'success');
                    } else {
                        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞
                        await addDoc(collection(db, "posts"), {
                            title,
                            description,
                            content: content || description,
                            url: urlData,
                            images: imagesData,
                            tags: selectedTags,
                            slug: slug,
                            createdAt: serverTimestamp()
                        });
                        
                        showNotification('–ù–æ–≤–æ—Å—Ç—å —É—Å–ø–µ—à–Ω–æ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞!', 'success');
                    }
                    
                    resetForm();
                    loadNewsFeed();
                    loadPostsList();
                    
                    if (!isEditing) {
                        setTimeout(() => {
                            router.navigate(`/${slug}`);
                        }, 1000);
                    } else {
                        showNotification('–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
                    }
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:', error);
                    showNotification('–û—à–∏–±–∫–∞: ' + error.message, 'error');
                }
            });
            
            // –ö–Ω–æ–ø–∫–∞ –æ—Ç–º–µ–Ω—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            document.getElementById('cancelEdit').addEventListener('click', resetForm);
            
            // –°–ª—É—à–∞—Ç–µ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
            onAuthStateChanged(auth, (user) => {
                const authBtn = document.getElementById('authBtn');
                const userInfo = document.getElementById('userInfo');
                const userEmail = document.getElementById('userEmail');
                const adminBtn = document.getElementById('adminBtn');
                
                currentUser = user;
                
                if (user) {
                    authBtn.classList.add('hidden');
                    userInfo.classList.remove('hidden');
                    userEmail.textContent = user.email;
                    
                    const isAdmin = allowedAdmins.includes(user.email);
                    if (isAdmin) {
                        adminBtn.classList.remove('hidden');
                        document.getElementById('postsManagement').classList.remove('hidden');
                        initCustomTags();
                    } else {
                        adminBtn.classList.add('hidden');
                        document.getElementById('postsManagement').classList.add('hidden');
                        if (router.getCurrentPath() === '/admin') {
                            router.navigate('/');
                        }
                    }
                } else {
                    authBtn.classList.remove('hidden');
                    userInfo.classList.add('hidden');
                    adminBtn.classList.add('hidden');
                    document.getElementById('postsManagement').classList.add('hidden');
                    if (router.getCurrentPath() === '/admin') {
                        router.navigate('/');
                    }
                }
            });
            
            // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω—ã–º–∏
            window.router = router;
            window.openAuthModal = openAuthModal;
            window.closeAuthModal = closeAuthModal;
            window.editPost = editPost;
            window.deletePostPrompt = deletePostPrompt;
            window.deleteComment = deleteComment;
            window.confirmDelete = confirmDelete;
            
            console.log('Neuron News SPA –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
